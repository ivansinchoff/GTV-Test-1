unique_name: V_VIEWING_30
object_type: dataset
label: V_VIEWING_30
columns:
  - name: TIME_ID
    data_type: decimal(38,0)
  - name: MEMBER_ID
    data_type: decimal(38,0)
  - name: MARKET_ID
    data_type: decimal(38,0)
  - name: CHANNEL_ID
    data_type: decimal(38,0)
  - name: ACTIVITY_ID
    data_type: decimal(38,0)
  - name: RESIDENCY_ID
    data_type: decimal(38,0)
  - name: SOURCE_ID
    data_type: decimal(38,0)
  - name: LOCATION_ID
    data_type: decimal(38,0)
  - name: ACTIVITY2_ID
    data_type: decimal(38,0)
  - name: MINUTE_REACH
    data_type: decimal(38,0)
  - name: HALFHOUR_MINUTE_ID
    data_type: decimal(38,0)
  - name: WEIGHT
    data_type: decimal(38,12)
  - name: REPETITION_COUNT
    data_type: decimal(38,0)
  - name: WEIGHT_REACH
    data_type: decimal(38,12)
  - name: REPETITION_COUNT_ATS_ACT2
    data_type: decimal(38,0)
  - name: REPETITION_COUNT_ATS_ACT1
    data_type: decimal(38,0)
  - name: DEMO_VIEW_ID
    data_type: string
  - name: DATE
    data_type: datetime
  - name: DEMO_MEDIA_TYPE_ID
    data_type: decimal(38,0)
  - name: SAMPLE_TYPE_ID
    data_type: decimal(38,0)
  - name: GENDER_ID
    data_type: decimal(38,0)
  - name: AGE_ID
    data_type: decimal(38,0)
  - name: SES_ID
    data_type: string
  - name: AREA_ID
    data_type: decimal(38,0)
  - name: HAS_CHILDREN
    data_type: string
  - name: HOUSEWIFE
    data_type: string
  - name: HOUSEHOLD
    data_type: string
  - name: TMINS
    data_type: decimal(38,0)
  - name: UK_WEIGHT
    data_type: decimal(38,12)
connection_id: con_TECH_DW_DB_ATSCALE_DW
sql: |-
  SELECT
  VM.*,
  D.DEMO_MEDIA_TYPE_ID,
  D.SAMPLE_TYPE_ID,
  D.GENDER_ID,
  D.AGE_ID,
  D.SES_ID,
  D.AREA_ID,
  D.HAS_CHILDREN,
  D.HOUSEWIFE,
  D.HOUSEHOLD,
  VM.HALFHOUR_MINUTE_ID * 30 AS TMINS,
  CASE 
  WHEN D.SAMPLE_TYPE_ID = 1 THEN VM.WEIGHT 
  ELSE NULL
  END AS UK_WEIGHT
  FROM TECH_DW_DB.ATSCALE_DW.VIEWING_MINUTE_PRE_AGG_LAYER VM
  LEFT JOIN TECH_DW_DB.ATSCALE_PUBL.V_DEMOGRAPHIC D
  ON VM.TIME_ID = D.TIME_ID
  AND VM.MEMBER_ID = D.MEMBER_ID
  AND VM.MARKET_ID = D.MARKET_ID
